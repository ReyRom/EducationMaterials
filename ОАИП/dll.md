# Лекция: Разработка библиотеки 

Создание собственной библиотеки на C++ в Visual Studio. Функции и классы могут быть скомпилированы как в динамическую библиотеку (DLL), так и в статическую библиотеку (LIB). Рассмотрим пошагово, как создать библиотеку в Visual Studio.

### Шаг 1: Создание проекта библиотеки

1. **Открыть Visual Studio:**
   - Запустите Visual Studio и создайте новый проект.

2. **Выбор типа проекта:**
   - Нажмите на **"Создать новый проект"**.
   - Выберите **"Библиотека динамической компоновки (DLL)"** для создания DLL или **"Статическая библиотека (.lib)"** для создания статической библиотеки.
   - Нажмите **"Далее"**.

3. **Настройка проекта:**
   - Введите имя проекта и выберите расположение для сохранения.
   - Нажмите **"Создать"**.

4. **Стандартные файлы:**
   - После создания проекта игнорируйте файлы `pch.h` и `pch.cpp` (если вы не собираетесь использовать предварительно скомпилированные заголовки). В некоторых случаях может быть необходимость добавить файл `pch.h` в заголовки `MyFunctions.cpp`

### Шаг 2: Добавление функций в библиотеку

1. **Создание заголовочного файла:**
   - Щелкните правой кнопкой мыши на проект в **Обозревателе решений**.
   - Выберите **Добавить → Новый элемент**.
   - Выберите **Заголовочный файл (.h)**, назовите его (например, `MyFunctions.h`) и нажмите **Добавить**.

2. **Создание файла реализации:**
   - Аналогичным образом добавьте файл реализации (.cpp). Назовите его (например, `MyFunctions.cpp`) и нажмите **Добавить**.

3. **Реализация функций:**
   - В заголовочном файле объявите ваши функции.
   - В файле реализации определите их.

Пример кода:

```cpp
// MyFunctions.h
#pragma once

// Экспортирование функций для DLL или LIB
#ifdef MYLIBRARY_EXPORTS
#define MYLIBRARY_API __declspec(dllexport)
#else
#define MYLIBRARY_API __declspec(dllimport)
#endif

extern "C" MYLIBRARY_API int add(int a, int b);
extern "C" MYLIBRARY_API int multiply(int a, int b);
```

```cpp
// MyFunctions.cpp
#include "MyFunctions.h"

int add(int a, int b) {
    return a + b;
}

int multiply(int a, int b) {
    return a * b;
}
```

В этом примере:
- Макрос `MYLIBRARY_API` используется для того, чтобы экспортировать функции из DLL. В случае статической библиотеки этот макрос не нужен.
- `extern "C"` используется для предотвращения "name mangling" (изменение имен функций компилятором), что позволяет функции библиотеки быть вызванными из кода на других языках.

### Шаг 3: Компиляция библиотеки

1. **Сборка проекта:**
   - После добавления и реализации функций, соберите проект: **Сборка → Построить решение**.
   - Если вы создаете DLL, Visual Studio создаст `.dll` файл и соответствующий `.lib` файл.
   - Если вы создаете статическую библиотеку, будет создан только `.lib` файл.

### Шаг 4: Использование библиотеки в другом проекте

1. **Создание нового проекта:**
   - Создайте новый проект в Visual Studio (например, консольное приложение) для использования вашей библиотеки.

2. **Подключение библиотеки:**
   - Щелкните правой кнопкой мыши на новый проект в **Обозревателе решений** и выберите **Свойства**.
   - Перейдите на вкладку **Свойства конфигурации → Компоновщик → Ввод**.
   - В поле **Дополнительные зависимости** добавьте путь к скомпилированной библиотеке (например, `MyLibrary.lib`).

3. **Добавление пути к заголовочным файлам:**
   - Перейдите в **Свойства конфигурации → C/C++ → Общие**.
   - В поле **Дополнительные каталоги включаемых файлов** добавьте путь к заголовочным файлам вашей библиотеки (например, папка, где находится `MyFunctions.h`).

4. **Использование функций из библиотеки:**
   Теперь вы можете подключить заголовочный файл и использовать функции в новом проекте.

Пример кода в новом проекте:

```cpp
#include <iostream>
#include "MyFunctions.h"

int main() {
    int sum = add(3, 4);
    int product = multiply(3, 4);
    
    std::cout << "Sum: " << sum << std::endl;
    std::cout << "Product: " << product << std::endl;
    
    return 0;
}
```

### Шаг 5: Работа с динамической библиотекой (DLL)

Если вы создаете динамическую библиотеку (DLL), убедитесь, что файл `.dll` находится в той же папке, что и исполняемый файл (`.exe`), либо добавьте его в системный путь, чтобы программа могла найти DLL во время выполнения.

### Заключение

Создание библиотеки в C++ с использованием Visual Studio включает в себя несколько этапов: создание проекта библиотеки, добавление функций, компиляция и использование библиотеки в других проектах. Используя этот подход, вы можете легко расширять код и повторно использовать его в различных приложениях.
